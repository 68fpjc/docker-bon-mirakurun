version: '3.4'
services:
  bon:
    build:
      context: ./dockerfiles/bon
    image: 68fpjc/bondriverproxy
    environment:
      TZ: Asia/Tokyo
      BONDRIVERPROXY_USELNB: 0,1
    devices:
      - /dev/px4video0:/dev/pt3video0
      - /dev/px4video1:/dev/pt3video1
      - /dev/px4video2:/dev/pt3video2
      - /dev/px4video3:/dev/pt3video3
      # - /dev/px4video4:/dev/pt3video4
      # - /dev/px4video5:/dev/pt3video5
      # - /dev/px4video6:/dev/pt3video6
      # - /dev/px4video7:/dev/pt3video7
    logging:
      driver: json-file
      options:
        max-size: '10m'
        max-file: '5'
    ports:
      - "1192:1192"
    # networks:
    #   - docker-b25_default
    restart: unless-stopped

  mirakc:
    build:
      context: ./dockerfiles/mirakc
      target: mirakc
      args:
        - BASE=mirakc/mirakc:0.16.1-debian
    image: 68fpjc/mirakc:0.16.1
    depends_on:
      - bon
    environment:
      TZ: Asia/Tokyo
      # Log level of `mirakc`.
      # See README.md in mirakc/mirakc.
      RUST_LOG: info
      # Output info-level log messages from child processes like
      # `mirakc-arib collect-eits` for debugging purpose.
      #
      # Normally, you don't need to define the following environment variables.
      MIRAKC_DEBUG_CHILD_PROCESS: ''
      MIRAKC_ARIG_LOG: info
    volumes:
      - ./data/mirakc/config.yml:/etc/mirakc/config.yml:ro
      - ./data/mirakc/epg/:/var/lib/mirakc/epg/
      - ./data/bon/:/var/lib/BonDriverProxy_Linux/config.in/:ro
    ports:
      - "40772:40772"
    # networks:
    #   - docker-b25_default
    logging:
      driver: json-file
      options:
        max-size: '10m'
        max-file: '5'
    restart: unless-stopped

# networks:
#   docker-b25_default:
#     external: true
